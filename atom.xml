<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>djdgctw çš„ç¡¬ä»¶ç¬”è®°</title>
  
  <subtitle>FPGA Â· Verilog Â· HDMI Â· SpinalHDL</subtitle>
  <link href="https://djdgctw.github.io/atom.xml" rel="self"/>
  
  <link href="https://djdgctw.github.io/"/>
  <updated>2025-11-26T00:02:41.220Z</updated>
  <id>https://djdgctw.github.io/</id>
  
  <author>
    <name>djdgctw</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HDMI1.4åè®®é˜…è¯»ç¬”è®°</title>
    <link href="https://djdgctw.github.io/2025/11/24/HDMI1.4%E5%8D%8F%E8%AE%AE%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    <id>https://djdgctw.github.io/2025/11/24/HDMI1.4%E5%8D%8F%E8%AE%AE%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/</id>
    <published>2025-11-24T06:30:00.000Z</published>
    <updated>2025-11-26T00:02:41.220Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HDMIä¼ è¾“ç³»ç»Ÿç»¼è¿°"><a href="#HDMIä¼ è¾“ç³»ç»Ÿç»¼è¿°" class="headerlink" title="HDMIä¼ è¾“ç³»ç»Ÿç»¼è¿°"></a>HDMIä¼ è¾“ç³»ç»Ÿç»¼è¿°</h1><p>ä¸€ä¸ª HDMI ä¼ è¾“ç³»ç»Ÿç”±å‘é€ç«¯ï¼ˆSourceï¼‰å’Œæ¥æ”¶ç«¯ï¼ˆSinkï¼‰ç»„æˆï¼Œçº¿ç¼†ä¸­ä¸»è¦åŒ…å«ï¼š</p><ul><li>å››ä¸ªå·®åˆ†å¯¹ç»„æˆçš„ä¸»æ•°æ®é“¾è·¯ï¼šä¸‰ä¸ª TMDS æ•°æ®é€šé“ + ä¸€ä¸ª TMDS æ—¶é’Ÿé€šé“</li><li>VESA DDCï¼ˆIÂ²Cï¼‰ï¼Œç”¨äºæ˜¾ç¤ºå‚æ•°çš„é…ç½®ä¸çŠ¶æ€è¯»å–</li><li>CECï¼ˆå¯é€‰ï¼‰ï¼Œæ¶ˆè´¹ç”µå­æ§åˆ¶æ€»çº¿</li><li>HEACï¼Œç”¨äºéŸ³é¢‘å›ä¼ å’Œä»¥å¤ªç½‘ä¿¡å·</li><li>HPDï¼Œçƒ­æ’æ‹”æ£€æµ‹</li></ul><p><img src="/img/02_HDMI/HDMI%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="HDMIæ¡†æ¶å›¾"></p><p>æœ¬æ–‡èšç„¦åœ¨ HDMI1.4 çš„æ•°æ®é“¾è·¯å±‚â€•â€•ä¹Ÿå°±æ˜¯ TMDS é“¾è·¯åœ¨è¡Œåœºæ—¶åºä¸­çš„ç»„ç»‡ä¸ç¼–ç æ–¹å¼ã€‚</p><h2 id="TMDSé“¾è·¯ä¸æ—¶åºæ€»è§ˆ"><a href="#TMDSé“¾è·¯ä¸æ—¶åºæ€»è§ˆ" class="headerlink" title="TMDSé“¾è·¯ä¸æ—¶åºæ€»è§ˆ"></a>TMDSé“¾è·¯ä¸æ—¶åºæ€»è§ˆ</h2><p>ä¸€å¸§è§†é¢‘åœ¨ TMDS é“¾è·¯ä¸Šä¼šè¢«æ‹†åˆ†ä¸ºä¸‰ä¸ªä¼ è¾“åŒºæ®µï¼š</p><ol><li><strong>Control Period</strong>ï¼šæ‰¿ä¸Šå¯ä¸‹ï¼Œå‘ŠçŸ¥å³å°†åˆ°æ¥çš„æ•°æ®ç±»å‹ï¼Œå¹¶æºå¸¦ HSYNC&#x2F;VSYNCã€‚</li><li><strong>Data Island Period</strong>ï¼šä¼ è¾“éŸ³é¢‘æ ·æœ¬ä¸å„ç§ InfoFrame è¾…åŠ©æ•°æ®ã€‚</li><li><strong>Video Data Period</strong>ï¼šä¼ è¾“æœ‰æ•ˆåƒç´ æ•°æ®ã€‚</li></ol><p>åŒæ­¥ä¿¡å· HSYNC&#x2F;VSYNC åœ¨ç‰¹å®šè¡Œã€åˆ—è¢«æ‹‰èµ·ï¼Œç”¨äº Source ä¸ Sink çš„å¸§æ—¶åºå¯¹é½ã€‚å®é™…çº¿ä¸Šä¼ è¾“çš„å¸§å°ºå¯¸å¤§äºæœ‰æ•ˆåˆ†è¾¨ç‡ï¼ˆä¾‹å¦‚ 720Ã—480pï¼‰ï¼Œå› ä¸ºåœ¨è¡Œé¦–ã€è¡Œå°¾åŠåœºé—´æ’å…¥äº† <strong>blank åŒºåŸŸ</strong>ï¼ˆåŒ…å« HBlank ä¸ VBlankï¼‰ã€‚è¿™äº› blank åŒºç”± Control Period ä¸ Data Island Period äº¤æ›¿å¡«å……ï¼Œè€ŒçœŸæ­£æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„åŒºåŸŸè¢«ç§°ä¸º <strong>active åŒº</strong>ï¼Œå³ Video Data Periodã€‚</p><p><img src="/img/02_HDMI/02.png" alt="æ˜¾ç¤ºæ—¶åºå›¾"></p><h3 id="TMDS-æ—¶é’Ÿä¸ç¼–ç ç²’åº¦"><a href="#TMDS-æ—¶é’Ÿä¸ç¼–ç ç²’åº¦" class="headerlink" title="TMDS æ—¶é’Ÿä¸ç¼–ç ç²’åº¦"></a>TMDS æ—¶é’Ÿä¸ç¼–ç ç²’åº¦</h3><p>åœ¨ TMDS clock é€šé“çš„æ¯ä¸€æ¬¡è·³å˜ï¼ˆä¸€ä¸ª TMDS Clockï¼‰ä¸­ï¼Œæ¯æ¡æ•°æ®é€šé“éƒ½ä¼šè¾“å‡ºä¸€ä¸ª 10bit çš„å­—ç¬¦ã€‚ä¸åŒç±»å‹çš„æ•°æ®ä½¿ç”¨ä¸åŒçš„ç¼–ç ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>åŸå§‹ä½å®½</th><th>ç¼–ç æ–¹å¼</th><th>è¾“å‡ºä½å®½</th></tr></thead><tbody><tr><td>Control data</td><td>2 bit</td><td>æ§åˆ¶å­—ç¬¦ç¼–ç </td><td>10 bit</td></tr><tr><td>Packet data</td><td>4 bit</td><td>TERC4 ç¼–ç </td><td>10 bit</td></tr><tr><td>Video data</td><td>8 bit</td><td>TMDS 8b&#x2F;10b ç¼–ç </td><td>10 bit</td></tr><tr><td>Guard Band</td><td>-</td><td>å›ºå®šæ§åˆ¶å­—ç¬¦</td><td>10 bit</td></tr></tbody></table><p>å› æ­¤â€œæ¯ä¸ª TMDS Clock &#x2F; æ¯æ¡æ•°æ®é€šé“å§‹ç»ˆ 10bitâ€è¿™æ¡è§„åˆ™è´¯ç©¿æ•´ä¸ªé“¾è·¯ï¼Œåªæ˜¯ç¼–ç æ–¹å¼ä¼šè·Ÿéšä¼ è¾“æœŸè€Œå˜åŒ–ã€‚</p><p><img src="/img/02_HDMI/03.png" alt="ä¿¡å·ä¼ è¾“æ¡†æ¶"></p><h2 id="Control-Periodï¼šæ‰¿ä¸Šå¯ä¸‹"><a href="#Control-Periodï¼šæ‰¿ä¸Šå¯ä¸‹" class="headerlink" title="Control Periodï¼šæ‰¿ä¸Šå¯ä¸‹"></a>Control Periodï¼šæ‰¿ä¸Šå¯ä¸‹</h2><p>Control Period æ˜¯ HDMI é“¾è·¯çš„â€œå‘¼å¸åŒºâ€ï¼Œå®ƒåœ¨ Video ä¸ Data Island ä¹‹é—´å¡«å……ï¼Œç”¨äºï¼š</p><ul><li>ä¼ è¾“ HSYNC &#x2F; VSYNCï¼ˆChannel0ï¼‰</li><li>å‘ŠçŸ¥æ¥ä¸‹æ¥æ˜¯ Video è¿˜æ˜¯ Data Islandï¼ˆChannel1&#x2F;2 ä¸Šçš„ CTL0~CTL3ï¼‰</li><li>æä¾›å­—ç¬¦åŒæ­¥ã€HDCP EESS ç­‰æ§åˆ¶ä¿¡æ¯</li></ul><table><thead><tr><th>é€šé“</th><th>æ‰¿è½½å†…å®¹</th></tr></thead><tbody><tr><td>Channel 0</td><td>HSYNCã€VSYNC</td></tr><tr><td>Channel 1</td><td>CTL0ã€CTL1</td></tr><tr><td>Channel 2</td><td>CTL2ã€CTL3</td></tr></tbody></table><h3 id="Preambleï¼šåˆ¤å®šä¸‹ä¸€ä¸ªå‘¨æœŸ"><a href="#Preambleï¼šåˆ¤å®šä¸‹ä¸€ä¸ªå‘¨æœŸ" class="headerlink" title="Preambleï¼šåˆ¤å®šä¸‹ä¸€ä¸ªå‘¨æœŸ"></a>Preambleï¼šåˆ¤å®šä¸‹ä¸€ä¸ªå‘¨æœŸ</h3><p>æ¯ä¸ªæ•°æ®å‘¨æœŸå¼€å§‹å‰éƒ½ä¼šæ’å…¥é•¿åº¦ä¸º 8 ä¸ª TMDS Clock çš„ Preambleï¼Œå…¨éƒ¨ç”±ç›¸åŒçš„æ§åˆ¶å­—ç¬¦æ„æˆï¼Œç”¨äºæç¤ºä¸‹ä¸€é˜¶æ®µçš„ç±»å‹ã€‚</p><p><img src="/img/02_HDMI/05.png"></p><p>åœ¨ Preamble æœŸé—´ HSYNCã€VSYNC æŒ‰åŸè¡ŒåœºèŠ‚å¥ç»§ç»­è¾“å‡ºï¼Œè€Œ CTL0~CTL3 ç»„åˆè¢«é™å®šä¸ºå¦‚ä¸‹ä¸¤ç§åˆæ³•å–å€¼ï¼š</p><table><thead><tr><th>CTL0</th><th>CTL1</th><th>CTL2</th><th>CTL3</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>1</td><td>0</td><td>0</td><td>0</td><td>ä¸‹ä¸€ä¸ªå‘¨æœŸæ˜¯ Video Data Period</td></tr><tr><td>1</td><td>0</td><td>1</td><td>0</td><td>ä¸‹ä¸€ä¸ªå‘¨æœŸæ˜¯ Data Island Period</td></tr></tbody></table><p><img src="/img/02_HDMI/06.png"></p><h3 id="Guard-Bandï¼šçœŸæ­£çš„æ•°æ®è¾¹ç•Œ"><a href="#Guard-Bandï¼šçœŸæ­£çš„æ•°æ®è¾¹ç•Œ" class="headerlink" title="Guard Bandï¼šçœŸæ­£çš„æ•°æ®è¾¹ç•Œ"></a>Guard Bandï¼šçœŸæ­£çš„æ•°æ®è¾¹ç•Œ</h3><p>Preamble ç»“æŸåç´§æ¥ç€ä¼šå‘é€ Guard Bandâ€•â€•ä¸¤ä¸ªç‰¹æ®Šçš„ TMDS å­—ç¬¦ï¼Œç”¨ä»¥æ ‡è®°æ•°æ®åŒºçš„çœŸå®èµ·ç‚¹ï¼ŒåŒæ—¶å‘ŠçŸ¥ Sink æ¥ä¸‹æ¥åˆ°åº•æ˜¯ Video è¿˜æ˜¯ Data Islandã€‚</p><ul><li>Video Guard Band åªå‡ºç°åœ¨ Video Data Period çš„èµ·å§‹ä½ç½®</li><li>Data Island Guard Band ä½äº Data Island Period çš„é¦–å°¾ï¼ˆLeading&#x2F;Trailingï¼Œå‡ä¸º 2 ä¸ª TMDS Clockï¼‰</li></ul><blockquote><p>Preamble ç”¨äºâ€œå®£å¸ƒç±»å‹â€ï¼ŒGuard Band ç”¨äºâ€œå®£å¸ƒå¼€å§‹â€ã€‚</p></blockquote><p>åè®®è§„å®š CTL&#x3D;1010 çš„æ§åˆ¶å­—ç¬¦åªå…è®¸å‡ºç°åœ¨ Preamble ä¸­ï¼Œå¦åˆ™æ¥æ”¶ç«¯å¯èƒ½è¯¯ä»¥ä¸º Data Island å³å°†åˆ°æ¥ã€‚</p><h3 id="Character-Synchronization"><a href="#Character-Synchronization" class="headerlink" title="Character Synchronization"></a>Character Synchronization</h3><ul><li>TMDS character æŒ‡ç¼–ç åçš„ 10bit å•å…ƒã€‚Video&#x2F;Data Island å­—ç¬¦çš„è·³å˜å¾ˆå°‘ï¼Œè€Œ Control å­—ç¬¦å¾€å¾€åŒ…å« &gt;&#x3D;5 æ¬¡è·³å˜ã€‚</li><li>Source å¿…é¡»è®©æ¯æ¬¡ Control Period è‡³å°‘æŒç»­ 2 ä¸ª TMDS Clockï¼Œè®© Sink å¯ä»¥å‡­å€Ÿè·³å˜å¯†åº¦ç¡®è®¤å­—ç¬¦è¾¹ç•Œã€‚</li><li>Source è¿˜éœ€è‡³å°‘æ¯ 50ms æ’å…¥ä¸€æ¬¡æŒç»­ 32 ä¸ª TMDS Clock çš„ Extended Control Periodï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ç¨³å›ºåŒæ­¥ã€‚</li></ul><p><img src="/img/02_HDMI/07.png"><br><img src="/img/02_HDMI/08.png"></p><h3 id="Control-Period-Encoding"><a href="#Control-Period-Encoding" class="headerlink" title="Control Period Encoding"></a>Control Period Encoding</h3><p>Control Period ä½¿ç”¨å›ºå®šè¡¨æ ¼å®Œæˆ 2bitâ†’10bit çš„ç¼–ç ï¼Œç¼–ç å½¢å¼ç¤ºæ„å¦‚ä¸‹ï¼š</p><p><img src="/img/02_HDMI/09.png"></p><h2 id="Data-Island-Periodï¼šéŸ³é¢‘ä¸è¾…åŠ©æ•°æ®"><a href="#Data-Island-Periodï¼šéŸ³é¢‘ä¸è¾…åŠ©æ•°æ®" class="headerlink" title="Data Island Periodï¼šéŸ³é¢‘ä¸è¾…åŠ©æ•°æ®"></a>Data Island Periodï¼šéŸ³é¢‘ä¸è¾…åŠ©æ•°æ®</h2><p>Data Island Period ä¸æ‰¿è½½åƒç´ ï¼Œè€Œæ˜¯è´Ÿè´£æ‰€æœ‰ Packet æ•°æ®ï¼ˆå¦‚ Audio Sampleã€AVI&#x2F;Vendor InfoFrame ç­‰ï¼‰ã€‚å…¶ç»„ç»‡è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>å‰ç½® 8 ä¸ª TMDS Clock çš„ Data Island Preamble</li><li>Leading &#x2F; Trailing Guard Band å„ 2 ä¸ª TMDS Clock</li><li>æ ¸å¿ƒæ•°æ®åŒºç”± 1~8 ä¸ª Packet ç»„æˆï¼ˆæ¯ä¸ª Packet å›ºå®š 32 ä¸ª TMDS Clockï¼‰</li><li>Preamble ä¹‹å‰å¿…é¡»æœ‰ â‰¥4 ä¸ª TMDS Clock çš„æ™®é€š Control Periodï¼Œä¿è¯å­—ç¬¦åŒæ­¥</li><li>Data Island ä¸ Video å‘¨æœŸé—´å¿…é¡»æ’å…¥è‡³å°‘ä¸€ä¸ª Control Periodï¼ŒäºŒè€…ä¸å¯ç›´æ¥ç›¸é‚»</li></ul><p><img src="/img/02_HDMI/04.png" alt="TMDS Period AND Encode"></p><h3 id="Guard-Band-æœŸé—´çš„é€šé“åˆ†å·¥"><a href="#Guard-Band-æœŸé—´çš„é€šé“åˆ†å·¥" class="headerlink" title="Guard Band æœŸé—´çš„é€šé“åˆ†å·¥"></a>Guard Band æœŸé—´çš„é€šé“åˆ†å·¥</h3><p>åœ¨ Data Island Guard Band å†…ï¼š</p><ul><li>Channel1&#x2F;Channel2 è¢«ç›´æ¥æ˜ å°„ä¸ºå›ºå®šçš„ 10bit å­—ç¬¦ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰</li><li>Channel0 ä¸­ D2&#x2F;D3 å›ºå®šä¸º 1ï¼›æ ¹æ® HSYNC&#x2F;VSYNC ä¸åŒï¼Œä¼šå‡ºç° 0xC~0xF å››ç§ nibbleï¼Œå†ç» TERC4 ç¼–ç å¾—åˆ°æœ€ç»ˆå­—ç¬¦</li></ul><p><img src="/img/02_HDMI/10.png" alt="Data Island Guard Bandé€šé“ç¼–ç "></p><p>ä¸æ­¤åŒæ—¶ï¼š</p><ul><li>Channel0 çš„ D0ã€D1 ä»æ‰¿æ‹… HSYNCã€VSYNC</li><li>Leading Guard Band ä¹‹åçš„ç¬¬ä¸€ä¸ª TMDS Clockï¼ŒChannel0 çš„ D3 ç½® 0ï¼Œå…¶ä½™æ—¶åˆ»ä¿æŒ 1</li><li>Channel1&#x2F;Channel2 çš„ 8bit æ•°æ®è´Ÿè´£ Packet å†…å®¹ï¼ˆGuard Band å†…é™¤å¤–ï¼‰</li></ul><h3 id="Packet-ç»“æ„"><a href="#Packet-ç»“æ„" class="headerlink" title="Packet ç»“æ„"></a>Packet ç»“æ„</h3><p>æ¯ä¸ª Packet &#x3D; Header + Bodyï¼Œä¸¤éƒ¨åˆ†éƒ½é…æœ‰ BCH æ ¡éªŒä½ï¼š</p><ol><li><strong>Packet Headerï¼ˆHB0&#x2F;HB1&#x2F;HB2ï¼‰</strong>  <ul><li>åŸå§‹ 24bit æ•°æ® + BCH(32,24) â†’ 32bit  </li><li>ç”± Channel0 çš„ D2 ä¼ è¾“</li></ul></li><li><strong>Packet Bodyï¼ˆ4 ä¸ª Subpacketï¼‰</strong>  <ul><li>æ¯ä¸ª Subpacketï¼š56bit æ•°æ® + BCH(64,56) â†’ 64bit  </li><li>å…± 4 ä¸ª Subpacketï¼ˆBlock0~Block3ï¼‰ï¼Œé€šè¿‡ Channel1&#x2F;Channel2 ä¼ è¾“</li></ul></li></ol><p>Subpacket ä¼šè¢«çº¿æ€§æ˜ å°„ä¸º PB0~PB27ï¼š</p><table><thead><tr><th>Subpacket</th><th>åŒ…å«å­—èŠ‚</th><th>æ˜ å°„åˆ° PB</th></tr></thead><tbody><tr><td>Subpacket0</td><td>SB0~SB6</td><td>PB0~PB6</td></tr><tr><td>Subpacket1</td><td>SB0~SB6</td><td>PB7~PB13</td></tr><tr><td>Subpacket2</td><td>SB0~SB6</td><td>PB14~PB20</td></tr><tr><td>Subpacket3</td><td>SB0~SB6</td><td>PB21~PB27</td></tr></tbody></table><p>è¿™ç§è¿ç»­æ˜ å°„ä¾¿äº Sink é€å­—èŠ‚è§£æ Packet Bodyï¼Œä¹Ÿæ»¡è¶³ BCH Block çš„æ•°æ®å¸ƒå±€è¦æ±‚ã€‚</p><p><img src="/img/02_HDMI/11.png" alt="Packetæ˜ å°„ç¤ºæ„"></p><h3 id="BCH-çº é”™"><a href="#BCH-çº é”™" class="headerlink" title="BCH çº é”™"></a>BCH çº é”™</h3><p>HDMI é€šè¿‡ BCH ç¼–ç ä¿è¯éŸ³é¢‘ä¸ InfoFrame æ•°æ®çš„å¯é æ€§ï¼š</p><ul><li>Subpacket ä½¿ç”¨ BCH(64,56)</li><li>Packet Header ä½¿ç”¨ BCH(32,24)</li></ul><p>ä¸‹å›¾ç»™å‡ºäº†å„å­—æ®µçš„ BCH ä½ç½®åˆ†å¸ƒï¼Œå…·ä½“å¤šé¡¹å¼ç•¥ã€‚</p><p><img src="/img/02_HDMI/12.png" alt="Packetçº é”™ä½"></p><h3 id="Data-Island-çš„ç¼–ç ï¼šTERC4"><a href="#Data-Island-çš„ç¼–ç ï¼šTERC4" class="headerlink" title="Data Island çš„ç¼–ç ï¼šTERC4"></a>Data Island çš„ç¼–ç ï¼šTERC4</h3><p>Data Island æ‰€æœ‰ 4bit æ•°æ®ï¼ˆGuard Bandã€Preambleã€Packet å†…å®¹ï¼‰éƒ½å¿…é¡»å…ˆè¿‡ <strong>TERC4</strong> ç¼–ç ï¼Œå†æ˜ å°„åˆ° 10bit TMDS å­—ç¬¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Data Island</span><br><span class="line"> â”œâ”€â”€ Guard Band (TERC4 å›ºå®šå­—ç¬¦)</span><br><span class="line"> â”œâ”€â”€ Preamble  (TERC4 å›ºå®šå­—ç¬¦)</span><br><span class="line"> â””â”€â”€ Packet</span><br><span class="line">      â”œâ”€â”€ Header (4bit nibbles é€ä¸ª TERC4)</span><br><span class="line">      â””â”€â”€ Body   (4bit nibbles é€ä¸ª TERC4)</span><br></pre></td></tr></table></figure><p><img src="/img/02_HDMI/13.png" alt="TERC4ç¼–ç ç¤ºæ„"></p><h2 id="Video-Data-Periodï¼šåƒç´ ä¼ è¾“"><a href="#Video-Data-Periodï¼šåƒç´ ä¼ è¾“" class="headerlink" title="Video Data Periodï¼šåƒç´ ä¼ è¾“"></a>Video Data Periodï¼šåƒç´ ä¼ è¾“</h2><p>Video Data Period æ˜¯ TMDS é“¾è·¯çœŸæ­£æ¬è¿ RGB åƒç´ çš„é˜¶æ®µï¼š</p><ul><li>Video Preambleï¼ˆ8 ä¸ª TMDS Clockï¼‰ + Video Guard Bandï¼ˆ2 ä¸ª TMDS Clockï¼Œä»…å‡ºç°åœ¨æ®µé¦–ï¼‰</li><li>Active Video åŒºåŸŸä¸‰æ¡é€šé“åˆ†åˆ«ä¼ è¾“ Blue&#x2F;Green&#x2F;Red çš„ 8bit æ•°æ®</li><li>ä¸‰æ¡é€šé“å…±å®Œæˆä¸€ä¸ªåƒç´ çš„ 24bit ä¼ è¾“ï¼ŒTMDS Clock &#x3D; Pixel Clock</li><li>åœ¨ InfoFrame ä¸­è¿˜ä¼šå£°æ˜å…·ä½“åƒç´ æ ¼å¼ã€è‰²åŸŸç­‰ä¿¡æ¯</li></ul><p><img src="/img/02_HDMI/14.png" alt="Video Data Period Signal"></p><h2 id="TMDS-ç¼–ç æµç¨‹ï¼ˆ8bitâ†’10bitï¼‰"><a href="#TMDS-ç¼–ç æµç¨‹ï¼ˆ8bitâ†’10bitï¼‰" class="headerlink" title="TMDS ç¼–ç æµç¨‹ï¼ˆ8bitâ†’10bitï¼‰"></a>TMDS ç¼–ç æµç¨‹ï¼ˆ8bitâ†’10bitï¼‰</h2><p>TMDSï¼ˆTransition Minimized Differential Signalingï¼‰çš„ç›®æ ‡æ˜¯<strong>å‡å°‘è·³å˜</strong>å’Œ<strong>ä¿æŒç›´æµå¹³è¡¡</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯æ‹†ä¸ºä¸¤æ­¥ï¼š</p><h3 id="Step-1ï¼š8bitâ†’9bitï¼ˆæœ€å°åŒ–è·³å˜ï¼‰"><a href="#Step-1ï¼š8bitâ†’9bitï¼ˆæœ€å°åŒ–è·³å˜ï¼‰" class="headerlink" title="Step 1ï¼š8bitâ†’9bitï¼ˆæœ€å°åŒ–è·³å˜ï¼‰"></a>Step 1ï¼š8bitâ†’9bitï¼ˆæœ€å°åŒ–è·³å˜ï¼‰</h3><p>ç¼–ç å™¨ä¼šåˆ†åˆ«å°è¯• XOR ä¸ XNOR ä¸¤ç§æ–¹å¼é€’æ¨ 8bit æ•°æ®ï¼š</p><ol><li>output[0] ç›´æ¥ç­‰äºè¾“å…¥ LSBã€‚</li><li>å¯¹ n&#x3D;1~7ï¼Œè®¡ç®— <code>output[n] = input[n] XOR output[n-1]</code>ï¼ˆæˆ– XNOR ç‰ˆæœ¬ï¼‰ã€‚</li><li>æ¯”è¾ƒä¸¤å¥—ç»“æœçš„è·³å˜æ¬¡æ•°ï¼Œé€‰æ‹©è·³å˜æ›´å°‘çš„é‚£å¥—ã€‚</li><li>ç”Ÿæˆçš„ 9bit ä¸­ï¼ŒMSB ç”¨æ¥æ ‡è®°é€‰æ‹©çš„æ˜¯ XORï¼ˆ0ï¼‰è¿˜æ˜¯ XNORï¼ˆ1ï¼‰ã€‚</li></ol><p>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span>  = <span class="number">1100_1010</span></span><br><span class="line">æ–¹æ¡ˆA = XOR  æ–¹å¼ç”Ÿæˆçš„ 9bit</span><br><span class="line">æ–¹æ¡ˆB = XNOR æ–¹å¼ç”Ÿæˆçš„ 9bit</span><br><span class="line"><span class="comment"># ç»Ÿè®¡ä¸¤å¥—ç»“æœçš„è·³å˜æ¬¡æ•°ï¼Œé€‰æ‹©è¾ƒå°è€…</span></span><br></pre></td></tr></table></figure><h3 id="Step-2ï¼š9bitâ†’10bitï¼ˆç›´æµå¹³è¡¡ï¼‰"><a href="#Step-2ï¼š9bitâ†’10bitï¼ˆç›´æµå¹³è¡¡ï¼‰" class="headerlink" title="Step 2ï¼š9bitâ†’10bitï¼ˆç›´æµå¹³è¡¡ï¼‰"></a>Step 2ï¼š9bitâ†’10bitï¼ˆç›´æµå¹³è¡¡ï¼‰</h3><p>ç¬¬äºŒæ­¥ä¸ºäº†å®ç° DC Balanceï¼Œä¼šå¢åŠ ç¬¬ 10bitï¼ˆé€šå¸¸è®°ä¸º <code>q_m[9]</code>ï¼‰ï¼Œå¹¶æ ¹æ®â€œå·²å‘é€ 1&#x2F;0 çš„ç´¯ç§¯å·®å€¼â€å†³å®šæ˜¯å¦å°†å‰ 9bit å–åã€‚</p><ul><li>å¦‚æœå½“å‰å­—ç¬¦ 1 æ¯” 0 å¤šä¸”ç´¯ç§¯å·®å€¼ä¹Ÿåæ­£ï¼Œåˆ™å–å</li><li>å¦‚æœç´¯ç§¯å·®ä¸å½“å‰å­—ç¬¦è¶‹åŠ¿ç›¸åï¼Œåˆ™ä¿æŒä¸å˜</li><li>ç¬¬ 10bit è®°å½•æ­¤æ¬¡æ˜¯å¦è¿›è¡Œäº†å–å</li></ul><p>å®Œæ•´æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥ç¼–ç æ€»å…±ä¼šäº§å‡º 460 ç§åˆæ³•çš„ 10bit å­—ç¬¦ã€‚åªè¦ç¼–ç å™¨è¿ä½œæ­£å¸¸ï¼ŒVideo Data Period ä¸­ä¸ä¼šå‡ºç°å…¶ä»–å­—ç¬¦ï¼›Guard Bandã€Control Periodã€Data Island åˆ™å„è‡ªä½¿ç”¨ä¸“ç”¨å­—ç¬¦é›†åˆï¼ŒSink å¯ä»¥æ®æ­¤åŒºåˆ†å½“å‰æ‰€å¤„çš„ Periodã€‚</p><p><img src="/img/02_HDMI/15.png" alt="TMDSç¼–ç æµç¨‹1"><br><img src="/img/02_HDMI/16.png" alt="TMDSç¼–ç æµç¨‹2"></p><h2 id="ç¼–ç æ–¹å¼é€ŸæŸ¥"><a href="#ç¼–ç æ–¹å¼é€ŸæŸ¥" class="headerlink" title="ç¼–ç æ–¹å¼é€ŸæŸ¥"></a>ç¼–ç æ–¹å¼é€ŸæŸ¥</h2><table><thead><tr><th>åœºæ™¯</th><th>è§¦å‘æ¡ä»¶</th><th>Guard Band</th><th>ç¼–ç æ–¹å¼</th></tr></thead><tbody><tr><td>Control Period</td><td>Video&#x2F;Data Island ä¹‹é—´çš„ç©ºæ¡£</td><td>å›ºå®šæ§åˆ¶å­—ç¬¦</td><td>2bitâ†’10bit æ§åˆ¶ç¼–ç </td></tr><tr><td>Data Island</td><td>Blank åŒºæ‰¿è½½éŸ³é¢‘&#x2F;InfoFrame</td><td>Leading+Trailingï¼ˆå„ 2 ä¸ª Clockï¼‰</td><td>TERC4ï¼ˆ4bitâ†’10bitï¼‰</td></tr><tr><td>Video Data</td><td>Active åŒºåƒç´ ä¼ è¾“</td><td>ä»… Leadingï¼ˆ2 ä¸ª Clockï¼‰</td><td>TMDSï¼ˆ8bitâ†’10bitï¼‰</td></tr></tbody></table><p><img src="/img/02_HDMI/17.png" alt="ç¼–ç å›¾"></p><p>é€šè¿‡ä»¥ä¸Šç»“æ„åŒ–æ‹†è§£ï¼Œå¯ä»¥æŠŠâ€œæ§åˆ¶â†’æ•°æ®å²›â†’è§†é¢‘â€çš„å¾ªç¯æƒ³è±¡æˆ HDMI é“¾è·¯æŒç»­å–˜æ¯çš„èŠ‚å¥ï¼šæ§åˆ¶æ®µæŠ¬æ‰‹ç¤ºæ„ã€Guard Band æ‰“å¼€å¼€åœºé—¨ã€éšåçš„æ•°æ®æ®µå„å¸å…¶èŒã€‚æŒæ¡è¿™ä¸€å¥—èŠ‚å¥ï¼Œå†é…åˆå…·ä½“çš„ç¼–ç æ–¹å¼ï¼Œå°±èƒ½é¡ºç•…é˜…è¯» HDMI1.4 åè®®æ–‡æ¡£ä¸­çš„ç»†èŠ‚ã€‚</p>]]></content>
    
    
    <summary type="html">HDMI1.4åè®®é˜…è¯»ç¬”è®°</summary>
    
    
    
    <category term="æ¥å£åè®®" scheme="https://djdgctw.github.io/categories/%E6%8E%A5%E5%8F%A3%E5%8D%8F%E8%AE%AE/"/>
    
    
    <category term="HDMI" scheme="https://djdgctw.github.io/tags/HDMI/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº Python çš„ Cocotb ä»¿çœŸç¯å¢ƒé…ç½®ï¼šVerilator Â· Cocotb Â· GTKWave</title>
    <link href="https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E5%89%8D%E4%BC%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <id>https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E5%89%8D%E4%BC%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/</id>
    <published>2025-11-23T06:30:00.000Z</published>
    <updated>2025-11-23T06:31:28.059Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>â€œè·‘é€š demo ä¹‹å‰ï¼Œå…ˆæŠŠç¯å¢ƒé…ç¨³å®šã€‚â€ â€”â€” æŠŠæ¯ä¸€æ­¥éƒ½å†™æ¸…æ¥šï¼Œåç»­å®éªŒå°±èƒ½å¿«é€Ÿå¤ç°ã€‚</p></blockquote><h2 id="1-Python-Cocotb-å®‰è£…"><a href="#1-Python-Cocotb-å®‰è£…" class="headerlink" title="1. Python &amp; Cocotb å®‰è£…"></a>1. Python &amp; Cocotb å®‰è£…</h2><h3 id="1-1-Python-ç¯å¢ƒ"><a href="#1-1-Python-ç¯å¢ƒ" class="headerlink" title="1.1 Python ç¯å¢ƒ"></a>1.1 Python ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨è Python 3.10+ï¼Œconda / pyenv å‡å¯</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install python3 python3-pip python3-venv -y</span><br><span class="line"></span><br><span class="line">python3 -m venv ~/.venvs/cocotb</span><br><span class="line"><span class="built_in">source</span> ~/.venvs/cocotb/bin/activate</span><br></pre></td></tr></table></figure><h3 id="1-2-å®‰è£…-Cocotb-åŠå¸¸ç”¨ä¾èµ–"><a href="#1-2-å®‰è£…-Cocotb-åŠå¸¸ç”¨ä¾èµ–" class="headerlink" title="1.2 å®‰è£… Cocotb åŠå¸¸ç”¨ä¾èµ–"></a>1.2 å®‰è£… Cocotb åŠå¸¸ç”¨ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip wheel</span><br><span class="line">pip install cocotb cocotb-bus pytest</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½¿ç”¨ VS Codeï¼Œè®°å¾—æŠŠè™šæ‹Ÿç¯å¢ƒæŒ‡å‘ <code>~/.venvs/cocotb</code>.</p></blockquote><h2 id="2-Verilator-å®‰è£…"><a href="#2-Verilator-å®‰è£…" class="headerlink" title="2. Verilator å®‰è£…"></a>2. Verilator å®‰è£…</h2><h3 id="2-1-apt-å®‰è£…ï¼ˆç®€å•ï¼‰"><a href="#2-1-apt-å®‰è£…ï¼ˆç®€å•ï¼‰" class="headerlink" title="2.1 apt å®‰è£…ï¼ˆç®€å•ï¼‰"></a>2.1 apt å®‰è£…ï¼ˆç®€å•ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install verilator -y</span><br><span class="line">verilator --version</span><br></pre></td></tr></table></figure><h3 id="2-2-æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰"><a href="#2-2-æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰" class="headerlink" title="2.2 æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰"></a>2.2 æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git perl python3 make autoconf g++ flex bison libfl2 libfl-dev \</span><br><span class="line">  zlibc zlib1g zlib1g-dev -y</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/verilator/verilator.git</span><br><span class="line"><span class="built_in">cd</span> verilator</span><br><span class="line">git checkout v5.026   <span class="comment"># æ ¹æ®éœ€è¦é€‰æ‹©ç‰ˆæœ¬</span></span><br><span class="line">autoconf</span><br><span class="line">./configure</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœç³»ç»Ÿå·²æœ‰æ—§ç‰ˆæœ¬ï¼Œå¯åœ¨ <code>~/.bashrc</code> ä¸­å°† <code>/usr/local/bin</code> æåˆ° <code>PATH</code> å‰é¢ï¼Œè®©æ–°ç‰ˆæœ¬ä¼˜å…ˆã€‚</p></blockquote><h2 id="3-GTKWave-å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰"><a href="#3-GTKWave-å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰" class="headerlink" title="3. GTKWave å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰"></a>3. GTKWave å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gtkwave -y</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å¯åŠ¨æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtkwave logs/dump.vcd &amp;</span><br></pre></td></tr></table></figure><p>é…åˆ Verilator&#x2F;Cocotb ç”Ÿæˆçš„ <code>.vcd</code> æˆ– <code>.fst</code> æ–‡ä»¶å³å¯ã€‚</p><h2 id="4-ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–"><a href="#4-ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–" class="headerlink" title="4. ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–"></a>4. ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/workspace/cocotb-demo &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/djdgctw/first_cocotb_testbench.git</span><br><span class="line"><span class="built_in">cd</span> first_cocotb_testbench/01_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">which</span> verilator</span><br><span class="line">python -c <span class="string">&quot;import cocotb; print(cocotb.__version__)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œä¸€æ¬¡ demo</span></span><br><span class="line">make run-logged SIM=verilator</span><br></pre></td></tr></table></figure><p>è‹¥è¾“å‡º <code>INFO: Running on Verilator ...</code> å¹¶ç”Ÿæˆ <code>logs/report.log</code>ï¼Œè¯´æ˜ç¯å¢ƒ OKã€‚</p><h2 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h2><table><thead><tr><th>ç°è±¡</th><th>å¤„ç†</th></tr></thead><tbody><tr><td><code>verilator: command not found</code></td><td>æ£€æŸ¥ <code>PATH</code>ï¼Œç¡®è®¤ <code>/usr/bin</code> æˆ– <code>/usr/local/bin</code> è¢«åŒ…å«ã€‚</td></tr><tr><td><code>ImportError: No module named &#39;cocotb&#39;</code></td><td>è™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»æˆ– pip å®‰è£…åœ¨ç³»ç»Ÿ Pythonï¼Œé‡æ–° <code>source ~/.venvs/cocotb/bin/activate</code>ã€‚</td></tr><tr><td>GTKWave æ‰“ä¸å¼€ä¸­æ–‡è·¯å¾„</td><td>é¿å…æŠŠæ³¢å½¢æ–‡ä»¶æ”¾åœ¨å«ä¸­æ–‡ç©ºæ ¼çš„è·¯å¾„ï¼Œæˆ–ä½¿ç”¨ <code>LANG=en_US.UTF-8 gtkwave ...</code>ã€‚</td></tr></tbody></table><h2 id="6-åç»­æ–‡ç« "><a href="#6-åç»­æ–‡ç« " class="headerlink" title="6. åç»­æ–‡ç« "></a>6. åç»­æ–‡ç« </h2><ul><li><a href="../%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80">åŸºäº Python çš„ Cocotb åº“å¯¹ Verilog è¿›è¡Œä»¿çœŸæ•™ç¨‹ï¼ˆä¸€ï¼‰</a></li><li>å³å°†æ›´æ–°ï¼šæ³¢å½¢å¯è§†åŒ–ã€ä¸ ModelSim&#x2F;Vivado IP ååŒçš„å®è·µ</li></ul><p>åšå¥½ç¯å¢ƒä¹‹åï¼Œåç»­çš„ Cocotb å®éªŒå°±åªå‰©â€œå†™ testbench + make runâ€è¿™ä¸¤ä¸ªåŠ¨ä½œï¼Œç¥ç©å¾—å¼€å¿ƒã€‚</p>]]></content>
    
    
    <summary type="html">è®°å½•åœ¨ Ubuntu/WSL ä¸Šæ­å»º Cocotb + Verilator + GTKWave ä»¿çœŸç¯å¢ƒçš„å…¨è¿‡ç¨‹ï¼Œæ–¹ä¾¿å¿«é€Ÿå¤åˆ»ã€‚</summary>
    
    
    
    <category term="å·¥å…·é“¾" scheme="https://djdgctw.github.io/categories/%E5%B7%A5%E5%85%B7%E9%93%BE/"/>
    
    
    <category term="cocotb" scheme="https://djdgctw.github.io/tags/cocotb/"/>
    
    <category term="verilator" scheme="https://djdgctw.github.io/tags/verilator/"/>
    
    <category term="gtkwave" scheme="https://djdgctw.github.io/tags/gtkwave/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº Python çš„ Cocotb åº“å¯¹ Verilog è¿›è¡Œä»¿çœŸæ•™ç¨‹ï¼ˆä¸€ï¼‰</title>
    <link href="https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80/"/>
    <id>https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80/</id>
    <published>2025-11-23T05:24:27.000Z</published>
    <updated>2025-11-23T06:28:38.974Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p>ğŸ‘‰ <a href="https://github.com/djdgctw/first_cocotb_testbench">https://github.com/djdgctw/first_cocotb_testbench</a></p><p>æœ¬æ•™ç¨‹å¯¹åº”ä»“åº“çš„ <code>01_base</code> ç¤ºä¾‹ï¼Œæ˜¯ Verilator Ã— Cocotb å…¥é—¨çš„æœ€å°å¯è¿è¡Œå·¥ç¨‹ã€‚</p><h2 id="1-è·‘é€š-01-base-åŸºç¡€æµç¨‹"><a href="#1-è·‘é€š-01-base-åŸºç¡€æµç¨‹" class="headerlink" title="1. è·‘é€š 01_base åŸºç¡€æµç¨‹"></a>1. è·‘é€š 01_base åŸºç¡€æµç¨‹</h2><p>ç¯å¢ƒè¦æ±‚ï¼š</p><ol><li>Ubuntuï¼ˆæˆ– WSL2ï¼‰</li><li>Verilatorï¼ˆapt æˆ–æºç ç¼–è¯‘å‡å¯ï¼‰</li><li>Pythonï¼ˆconda &#x2F; ç³»ç»Ÿ Python å‡å¯ï¼‰</li><li><code>pip install cocotb</code></li></ol><p>å…‹éš†ä»“åº“åè¿›å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> first_cocotb_testbench/01_base</span><br></pre></td></tr></table></figure><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/img/01_cocotb/01.png" alt="01_baseé¡¹ç›®ç»“æ„ç¤ºæ„å›¾"></p><h2 id="2-ç¤ºä¾‹æµç¨‹è®²è§£"><a href="#2-ç¤ºä¾‹æµç¨‹è®²è§£" class="headerlink" title="2. ç¤ºä¾‹æµç¨‹è®²è§£"></a>2. ç¤ºä¾‹æµç¨‹è®²è§£</h2><p>åœ¨ <code>01_base</code> ç›®å½•ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make run-logged SIM=verilator</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šï¼š</p><ul><li>è°ƒç”¨ cocotb çš„ Makefile ä½“ç³»</li><li>ä½¿ç”¨ Verilator å¯¹ <code>src/dff.sv</code> è¿›è¡Œç¼–è¯‘</li><li>è¿è¡Œ Python ä¾§çš„ testbench</li><li>å°†è¿è¡Œæ—¥å¿—ä¸æ³¢å½¢å­˜å…¥ <code>logs/</code> ç›®å½•ï¼ˆå« <code>report.log</code> ä¸æ³¢å½¢æ–‡ä»¶ï¼‰</li></ul><p>Makefile å…³é”®é€»è¾‘å¦‚ä¸‹ï¼š<br><img src="/img/01_cocotb/02.png" alt="makefileéƒ¨åˆ†ä»£ç "></p><h2 id="3-åŸç†è®²è§£"><a href="#3-åŸç†è®²è§£" class="headerlink" title="3. åŸç†è®²è§£"></a>3. åŸç†è®²è§£</h2><p>æœ¬ç¤ºä¾‹ç”± Verilog è®¾è®¡æ–‡ä»¶ <code>dff.sv</code> å’Œ Python Cocotb æµ‹è¯•æ–‡ä»¶ <code>test_dff.py</code> ç»„æˆï¼ŒäºŒè€…é€šè¿‡ cocotb çš„ VPI&#x2F;PLI æ¥å£å»ºç«‹äº¤äº’ã€‚</p><h3 id="3-1-Verilog-ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å—-DUTï¼‰"><a href="#3-1-Verilog-ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å—-DUTï¼‰" class="headerlink" title="3.1 Verilog ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å— DUTï¼‰"></a>3.1 Verilog ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å— DUTï¼‰</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1us/1ns</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> dff (</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] q,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>       clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] d</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    q &lt;= d;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>ä¸Šå‡æ²¿é‡‡æ ·ï¼šæ¯ä¸ª <code>posedge clk</code>ï¼Œ<code>q</code> éƒ½ä¼šæ›´æ–°ä¸º <code>d</code></li><li>å»¶è¿Ÿè¯­ä¹‰ï¼šè¡Œä¸ºç­‰ä»·äº â€œq &#x3D; d ä¸Šä¸€æ‹çš„å€¼â€</li></ul><h3 id="3-2-Cocotb-Python-æµ‹è¯•ä»£ç è®²è§£"><a href="#3-2-Cocotb-Python-æµ‹è¯•ä»£ç è®²è§£" class="headerlink" title="3.2 Cocotb Python æµ‹è¯•ä»£ç è®²è§£"></a>3.2 Cocotb Python æµ‹è¯•ä»£ç è®²è§£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> cocotb</span><br><span class="line"><span class="keyword">from</span> cocotb.clock <span class="keyword">import</span> Clock</span><br><span class="line"><span class="keyword">from</span> cocotb.triggers <span class="keyword">import</span> FallingEdge</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="meta">@cocotb.test()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test_dff_simple</span>(<span class="params">dut</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;éªŒè¯ d èƒ½æ­£ç¡®ä¼ é€’åˆ° q&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    logger = logging.getLogger(<span class="string">&quot;my_testbench&quot;</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">    clock = Clock(dut.clk, <span class="number">10</span>, unit=<span class="string">&quot;us&quot;</span>)</span><br><span class="line">    cocotb.start_soon(clock.start())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        val = random.randint(<span class="number">0</span>, <span class="number">7</span>)</span><br><span class="line">        dut.d.value = val</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> FallingEdge(dut.clk)</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">f&quot;å‘¨æœŸ <span class="subst">&#123;i&#125;</span>: d=<span class="subst">&#123;dut.d.value&#125;</span>, q=<span class="subst">&#123;dut.q.value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> dut.q.value == val, <span class="string">f&quot;ç¬¬ <span class="subst">&#123;i&#125;</span> æ¬¡æ£€æŸ¥å¤±è´¥ï¼šæœŸæœ› <span class="subst">&#123;val&#125;</span>ï¼Œå®é™… <span class="subst">&#123;dut.q.value&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹ï¼š</p><ul><li><code>@cocotb.test()</code>ï¼šå£°æ˜ Python æµ‹è¯•ç”¨ä¾‹</li><li><code>Clock(...)</code>ï¼šåœ¨ Python ä¾§åˆ›å»ºæ—¶é’Ÿå¹¶é©±åŠ¨ DUT</li><li><code>await FallingEdge(...)</code>ï¼šäº‹ä»¶é©±åŠ¨å¼ä»¿çœŸ</li><li><code>.value</code> æ˜¯ cocotb å†™å…¥å’Œè¯»å–ä¿¡å·çš„æ ‡å‡†æ–¹å¼</li><li>æ–­è¨€é”™è¯¯ä¼šè‡ªåŠ¨æ ‡çº¢ä¸­æ­¢</li></ul><h3 id="3-3-Makefile-æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š"><a href="#3-3-Makefile-æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š" class="headerlink" title="3.3 Makefile æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š"></a>3.3 Makefile æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> PYTHONPATH := <span class="variable">$(PWD)</span>/testbench:<span class="variable">$(PYTHONPATH)</span></span><br><span class="line">TOPLEVEL_LANG = verilog</span><br><span class="line">VERILOG_SOURCES = <span class="variable">$(PWD)</span>/src/dff.sv</span><br><span class="line">TOPLEVEL = dff</span><br><span class="line">MODULE = test_dff</span><br><span class="line">SIM ?= verilator</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(<span class="built_in">shell</span> cocotb-config --makefiles)</span>/Makefile.sim</span><br></pre></td></tr></table></figure><p>ç®€è¦è¯´æ˜ï¼š</p><ul><li><code>TOPLEVEL</code> å¿…é¡»ä¸ Verilog ä¸­çš„æ¨¡å—åä¸€è‡´</li><li><code>MODULE=test_dff</code> æŒ‡å®š Python æµ‹è¯•å…¥å£</li><li><code>VERILOG_SOURCES</code> å†³å®šå‚ä¸ä»¿çœŸçš„ RTL æ–‡ä»¶</li><li><code>cocotb-config</code> è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„ä»¿çœŸå™¨åç«¯</li></ul><blockquote><p><strong>æ¢æ¨¡å—æ—¶ï¼Œåªéœ€æ”¹ï¼š</strong><br><code>src/*.sv</code>ã€<code>TOPLEVEL</code>ã€<code>MODULE</code>ï¼Œå…¶ä½™é€»è¾‘æ— éœ€ä¿®æ”¹ã€‚</p></blockquote><h2 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4. å°ç»“"></a>4. å°ç»“</h2><p>æœ¬ç¯‡ç¤ºä¾‹å±•ç¤ºäº† Cocotb æœ€å°å¯è¿è¡Œå·¥ç¨‹çš„ç»“æ„å’ŒåŸç†ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>Verilator + Cocotb çš„ååŒä»¿çœŸæµç¨‹</li><li>Verilog DUT çš„æ„æˆ</li><li>Python å¼‚æ­¥ testbench çš„å†™æ³•</li><li>Makefile å¦‚ä½•å°†ä¸¤è€…ä¸²è”</li></ul><p>åç»­ç¯‡ç« å°†ç»§ç»­æ›´æ–°ï¼š</p><ul><li>å¦‚ä½•åˆ©ç”¨ Python æŠŠä»¿çœŸç»“æœè½¬æ¢ä¸ºå¯è§†åŒ–å›¾è¡¨</li><li>å¦‚ä½•è®© Cocotb é€šè¿‡ ModelSim æ”¯æŒå¸¦ Vivado IP çš„ä»¿çœŸ</li></ul>]]></content>
    
    
    <summary type="html">åŸºäº Verilator ä¸ Cocotb å¯¹ Verilog æ¨¡å—è¿›è¡ŒååŒä»¿çœŸçš„åŸºç¡€æµç¨‹ä¸åŸç†è®²è§£</summary>
    
    
    
    
    <category term="cocotb" scheme="https://djdgctw.github.io/tags/cocotb/"/>
    
    <category term="verilog" scheme="https://djdgctw.github.io/tags/verilog/"/>
    
  </entry>
  
</feed>
