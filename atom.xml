<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>djdgctw çš„ç¡¬ä»¶ç¬”è®°</title>
  
  <subtitle>FPGA Â· Verilog Â· HDMI Â· SpinalHDL</subtitle>
  <link href="https://djdgctw.github.io/atom.xml" rel="self"/>
  
  <link href="https://djdgctw.github.io/"/>
  <updated>2025-11-23T06:31:28.059Z</updated>
  <id>https://djdgctw.github.io/</id>
  
  <author>
    <name>djdgctw</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åŸºäº Python çš„ Cocotb ä»¿çœŸç¯å¢ƒé…ç½®ï¼šVerilator Â· Cocotb Â· GTKWave</title>
    <link href="https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E5%89%8D%E4%BC%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <id>https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E5%89%8D%E4%BC%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/</id>
    <published>2025-11-23T06:30:00.000Z</published>
    <updated>2025-11-23T06:31:28.059Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>â€œè·‘é€š demo ä¹‹å‰ï¼Œå…ˆæŠŠç¯å¢ƒé…ç¨³å®šã€‚â€ â€”â€” æŠŠæ¯ä¸€æ­¥éƒ½å†™æ¸…æ¥šï¼Œåç»­å®éªŒå°±èƒ½å¿«é€Ÿå¤ç°ã€‚</p></blockquote><h2 id="1-Python-Cocotb-å®‰è£…"><a href="#1-Python-Cocotb-å®‰è£…" class="headerlink" title="1. Python &amp; Cocotb å®‰è£…"></a>1. Python &amp; Cocotb å®‰è£…</h2><h3 id="1-1-Python-ç¯å¢ƒ"><a href="#1-1-Python-ç¯å¢ƒ" class="headerlink" title="1.1 Python ç¯å¢ƒ"></a>1.1 Python ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨è Python 3.10+ï¼Œconda / pyenv å‡å¯</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install python3 python3-pip python3-venv -y</span><br><span class="line"></span><br><span class="line">python3 -m venv ~/.venvs/cocotb</span><br><span class="line"><span class="built_in">source</span> ~/.venvs/cocotb/bin/activate</span><br></pre></td></tr></table></figure><h3 id="1-2-å®‰è£…-Cocotb-åŠå¸¸ç”¨ä¾èµ–"><a href="#1-2-å®‰è£…-Cocotb-åŠå¸¸ç”¨ä¾èµ–" class="headerlink" title="1.2 å®‰è£… Cocotb åŠå¸¸ç”¨ä¾èµ–"></a>1.2 å®‰è£… Cocotb åŠå¸¸ç”¨ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip wheel</span><br><span class="line">pip install cocotb cocotb-bus pytest</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½¿ç”¨ VS Codeï¼Œè®°å¾—æŠŠè™šæ‹Ÿç¯å¢ƒæŒ‡å‘ <code>~/.venvs/cocotb</code>.</p></blockquote><h2 id="2-Verilator-å®‰è£…"><a href="#2-Verilator-å®‰è£…" class="headerlink" title="2. Verilator å®‰è£…"></a>2. Verilator å®‰è£…</h2><h3 id="2-1-apt-å®‰è£…ï¼ˆç®€å•ï¼‰"><a href="#2-1-apt-å®‰è£…ï¼ˆç®€å•ï¼‰" class="headerlink" title="2.1 apt å®‰è£…ï¼ˆç®€å•ï¼‰"></a>2.1 apt å®‰è£…ï¼ˆç®€å•ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install verilator -y</span><br><span class="line">verilator --version</span><br></pre></td></tr></table></figure><h3 id="2-2-æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰"><a href="#2-2-æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰" class="headerlink" title="2.2 æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰"></a>2.2 æºç å®‰è£…ï¼ˆéœ€è¦æœ€æ–°ç‰ˆæœ¬æ—¶ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install git perl python3 make autoconf g++ flex bison libfl2 libfl-dev \</span><br><span class="line">  zlibc zlib1g zlib1g-dev -y</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/verilator/verilator.git</span><br><span class="line"><span class="built_in">cd</span> verilator</span><br><span class="line">git checkout v5.026   <span class="comment"># æ ¹æ®éœ€è¦é€‰æ‹©ç‰ˆæœ¬</span></span><br><span class="line">autoconf</span><br><span class="line">./configure</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœç³»ç»Ÿå·²æœ‰æ—§ç‰ˆæœ¬ï¼Œå¯åœ¨ <code>~/.bashrc</code> ä¸­å°† <code>/usr/local/bin</code> æåˆ° <code>PATH</code> å‰é¢ï¼Œè®©æ–°ç‰ˆæœ¬ä¼˜å…ˆã€‚</p></blockquote><h2 id="3-GTKWave-å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰"><a href="#3-GTKWave-å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰" class="headerlink" title="3. GTKWave å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰"></a>3. GTKWave å®‰è£…ï¼ˆæ³¢å½¢æŸ¥çœ‹ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gtkwave -y</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å¯åŠ¨æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gtkwave logs/dump.vcd &amp;</span><br></pre></td></tr></table></figure><p>é…åˆ Verilator&#x2F;Cocotb ç”Ÿæˆçš„ <code>.vcd</code> æˆ– <code>.fst</code> æ–‡ä»¶å³å¯ã€‚</p><h2 id="4-ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–"><a href="#4-ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–" class="headerlink" title="4. ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–"></a>4. ä»¿çœŸå·¥ç¨‹æ¨¡æ¿åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/workspace/cocotb-demo &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/djdgctw/first_cocotb_testbench.git</span><br><span class="line"><span class="built_in">cd</span> first_cocotb_testbench/01_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">which</span> verilator</span><br><span class="line">python -c <span class="string">&quot;import cocotb; print(cocotb.__version__)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œä¸€æ¬¡ demo</span></span><br><span class="line">make run-logged SIM=verilator</span><br></pre></td></tr></table></figure><p>è‹¥è¾“å‡º <code>INFO: Running on Verilator ...</code> å¹¶ç”Ÿæˆ <code>logs/report.log</code>ï¼Œè¯´æ˜ç¯å¢ƒ OKã€‚</p><h2 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h2><table><thead><tr><th>ç°è±¡</th><th>å¤„ç†</th></tr></thead><tbody><tr><td><code>verilator: command not found</code></td><td>æ£€æŸ¥ <code>PATH</code>ï¼Œç¡®è®¤ <code>/usr/bin</code> æˆ– <code>/usr/local/bin</code> è¢«åŒ…å«ã€‚</td></tr><tr><td><code>ImportError: No module named &#39;cocotb&#39;</code></td><td>è™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»æˆ– pip å®‰è£…åœ¨ç³»ç»Ÿ Pythonï¼Œé‡æ–° <code>source ~/.venvs/cocotb/bin/activate</code>ã€‚</td></tr><tr><td>GTKWave æ‰“ä¸å¼€ä¸­æ–‡è·¯å¾„</td><td>é¿å…æŠŠæ³¢å½¢æ–‡ä»¶æ”¾åœ¨å«ä¸­æ–‡ç©ºæ ¼çš„è·¯å¾„ï¼Œæˆ–ä½¿ç”¨ <code>LANG=en_US.UTF-8 gtkwave ...</code>ã€‚</td></tr></tbody></table><h2 id="6-åç»­æ–‡ç« "><a href="#6-åç»­æ–‡ç« " class="headerlink" title="6. åç»­æ–‡ç« "></a>6. åç»­æ–‡ç« </h2><ul><li><a href="../%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80">åŸºäº Python çš„ Cocotb åº“å¯¹ Verilog è¿›è¡Œä»¿çœŸæ•™ç¨‹ï¼ˆä¸€ï¼‰</a></li><li>å³å°†æ›´æ–°ï¼šæ³¢å½¢å¯è§†åŒ–ã€ä¸ ModelSim&#x2F;Vivado IP ååŒçš„å®è·µ</li></ul><p>åšå¥½ç¯å¢ƒä¹‹åï¼Œåç»­çš„ Cocotb å®éªŒå°±åªå‰©â€œå†™ testbench + make runâ€è¿™ä¸¤ä¸ªåŠ¨ä½œï¼Œç¥ç©å¾—å¼€å¿ƒã€‚</p>]]></content>
    
    
    <summary type="html">è®°å½•åœ¨ Ubuntu/WSL ä¸Šæ­å»º Cocotb + Verilator + GTKWave ä»¿çœŸç¯å¢ƒçš„å…¨è¿‡ç¨‹ï¼Œæ–¹ä¾¿å¿«é€Ÿå¤åˆ»ã€‚</summary>
    
    
    
    <category term="å·¥å…·é“¾" scheme="https://djdgctw.github.io/categories/%E5%B7%A5%E5%85%B7%E9%93%BE/"/>
    
    
    <category term="cocotb" scheme="https://djdgctw.github.io/tags/cocotb/"/>
    
    <category term="verilator" scheme="https://djdgctw.github.io/tags/verilator/"/>
    
    <category term="gtkwave" scheme="https://djdgctw.github.io/tags/gtkwave/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäº Python çš„ Cocotb åº“å¯¹ Verilog è¿›è¡Œä»¿çœŸæ•™ç¨‹ï¼ˆä¸€ï¼‰</title>
    <link href="https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80/"/>
    <id>https://djdgctw.github.io/2025/11/23/%E5%9F%BA%E4%BA%8Epython%E7%9A%84cocotb%E5%BA%93%E5%AF%B9verilog%E8%BF%9B%E8%A1%8C%E4%BB%BF%E7%9C%9F%E6%95%99%E7%A8%8B-%E4%B8%80/</id>
    <published>2025-11-23T05:24:27.000Z</published>
    <updated>2025-11-23T06:28:38.974Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p>ğŸ‘‰ <a href="https://github.com/djdgctw/first_cocotb_testbench">https://github.com/djdgctw/first_cocotb_testbench</a></p><p>æœ¬æ•™ç¨‹å¯¹åº”ä»“åº“çš„ <code>01_base</code> ç¤ºä¾‹ï¼Œæ˜¯ Verilator Ã— Cocotb å…¥é—¨çš„æœ€å°å¯è¿è¡Œå·¥ç¨‹ã€‚</p><h2 id="1-è·‘é€š-01-base-åŸºç¡€æµç¨‹"><a href="#1-è·‘é€š-01-base-åŸºç¡€æµç¨‹" class="headerlink" title="1. è·‘é€š 01_base åŸºç¡€æµç¨‹"></a>1. è·‘é€š 01_base åŸºç¡€æµç¨‹</h2><p>ç¯å¢ƒè¦æ±‚ï¼š</p><ol><li>Ubuntuï¼ˆæˆ– WSL2ï¼‰</li><li>Verilatorï¼ˆapt æˆ–æºç ç¼–è¯‘å‡å¯ï¼‰</li><li>Pythonï¼ˆconda &#x2F; ç³»ç»Ÿ Python å‡å¯ï¼‰</li><li><code>pip install cocotb</code></li></ol><p>å…‹éš†ä»“åº“åè¿›å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> first_cocotb_testbench/01_base</span><br></pre></td></tr></table></figure><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/img/01_cocotb/01.png" alt="01_baseé¡¹ç›®ç»“æ„ç¤ºæ„å›¾"></p><h2 id="2-ç¤ºä¾‹æµç¨‹è®²è§£"><a href="#2-ç¤ºä¾‹æµç¨‹è®²è§£" class="headerlink" title="2. ç¤ºä¾‹æµç¨‹è®²è§£"></a>2. ç¤ºä¾‹æµç¨‹è®²è§£</h2><p>åœ¨ <code>01_base</code> ç›®å½•ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make run-logged SIM=verilator</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šï¼š</p><ul><li>è°ƒç”¨ cocotb çš„ Makefile ä½“ç³»</li><li>ä½¿ç”¨ Verilator å¯¹ <code>src/dff.sv</code> è¿›è¡Œç¼–è¯‘</li><li>è¿è¡Œ Python ä¾§çš„ testbench</li><li>å°†è¿è¡Œæ—¥å¿—ä¸æ³¢å½¢å­˜å…¥ <code>logs/</code> ç›®å½•ï¼ˆå« <code>report.log</code> ä¸æ³¢å½¢æ–‡ä»¶ï¼‰</li></ul><p>Makefile å…³é”®é€»è¾‘å¦‚ä¸‹ï¼š<br><img src="/img/01_cocotb/02.png" alt="makefileéƒ¨åˆ†ä»£ç "></p><h2 id="3-åŸç†è®²è§£"><a href="#3-åŸç†è®²è§£" class="headerlink" title="3. åŸç†è®²è§£"></a>3. åŸç†è®²è§£</h2><p>æœ¬ç¤ºä¾‹ç”± Verilog è®¾è®¡æ–‡ä»¶ <code>dff.sv</code> å’Œ Python Cocotb æµ‹è¯•æ–‡ä»¶ <code>test_dff.py</code> ç»„æˆï¼ŒäºŒè€…é€šè¿‡ cocotb çš„ VPI&#x2F;PLI æ¥å£å»ºç«‹äº¤äº’ã€‚</p><h3 id="3-1-Verilog-ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å—-DUTï¼‰"><a href="#3-1-Verilog-ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å—-DUTï¼‰" class="headerlink" title="3.1 Verilog ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å— DUTï¼‰"></a>3.1 Verilog ä»£ç è®²è§£ï¼ˆè¢«æµ‹æ¨¡å— DUTï¼‰</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1us/1ns</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> dff (</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] q,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>       clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] d</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    q &lt;= d;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>ä¸Šå‡æ²¿é‡‡æ ·ï¼šæ¯ä¸ª <code>posedge clk</code>ï¼Œ<code>q</code> éƒ½ä¼šæ›´æ–°ä¸º <code>d</code></li><li>å»¶è¿Ÿè¯­ä¹‰ï¼šè¡Œä¸ºç­‰ä»·äº â€œq &#x3D; d ä¸Šä¸€æ‹çš„å€¼â€</li></ul><h3 id="3-2-Cocotb-Python-æµ‹è¯•ä»£ç è®²è§£"><a href="#3-2-Cocotb-Python-æµ‹è¯•ä»£ç è®²è§£" class="headerlink" title="3.2 Cocotb Python æµ‹è¯•ä»£ç è®²è§£"></a>3.2 Cocotb Python æµ‹è¯•ä»£ç è®²è§£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> cocotb</span><br><span class="line"><span class="keyword">from</span> cocotb.clock <span class="keyword">import</span> Clock</span><br><span class="line"><span class="keyword">from</span> cocotb.triggers <span class="keyword">import</span> FallingEdge</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="meta">@cocotb.test()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">test_dff_simple</span>(<span class="params">dut</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;éªŒè¯ d èƒ½æ­£ç¡®ä¼ é€’åˆ° q&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    logger = logging.getLogger(<span class="string">&quot;my_testbench&quot;</span>)</span><br><span class="line">    logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">    clock = Clock(dut.clk, <span class="number">10</span>, unit=<span class="string">&quot;us&quot;</span>)</span><br><span class="line">    cocotb.start_soon(clock.start())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        val = random.randint(<span class="number">0</span>, <span class="number">7</span>)</span><br><span class="line">        dut.d.value = val</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> FallingEdge(dut.clk)</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">f&quot;å‘¨æœŸ <span class="subst">&#123;i&#125;</span>: d=<span class="subst">&#123;dut.d.value&#125;</span>, q=<span class="subst">&#123;dut.q.value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> dut.q.value == val, <span class="string">f&quot;ç¬¬ <span class="subst">&#123;i&#125;</span> æ¬¡æ£€æŸ¥å¤±è´¥ï¼šæœŸæœ› <span class="subst">&#123;val&#125;</span>ï¼Œå®é™… <span class="subst">&#123;dut.q.value&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹ï¼š</p><ul><li><code>@cocotb.test()</code>ï¼šå£°æ˜ Python æµ‹è¯•ç”¨ä¾‹</li><li><code>Clock(...)</code>ï¼šåœ¨ Python ä¾§åˆ›å»ºæ—¶é’Ÿå¹¶é©±åŠ¨ DUT</li><li><code>await FallingEdge(...)</code>ï¼šäº‹ä»¶é©±åŠ¨å¼ä»¿çœŸ</li><li><code>.value</code> æ˜¯ cocotb å†™å…¥å’Œè¯»å–ä¿¡å·çš„æ ‡å‡†æ–¹å¼</li><li>æ–­è¨€é”™è¯¯ä¼šè‡ªåŠ¨æ ‡çº¢ä¸­æ­¢</li></ul><h3 id="3-3-Makefile-æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š"><a href="#3-3-Makefile-æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š" class="headerlink" title="3.3 Makefile æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š"></a>3.3 Makefile æ ¸å¿ƒéƒ¨åˆ†è§£é‡Š</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> PYTHONPATH := <span class="variable">$(PWD)</span>/testbench:<span class="variable">$(PYTHONPATH)</span></span><br><span class="line">TOPLEVEL_LANG = verilog</span><br><span class="line">VERILOG_SOURCES = <span class="variable">$(PWD)</span>/src/dff.sv</span><br><span class="line">TOPLEVEL = dff</span><br><span class="line">MODULE = test_dff</span><br><span class="line">SIM ?= verilator</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(<span class="built_in">shell</span> cocotb-config --makefiles)</span>/Makefile.sim</span><br></pre></td></tr></table></figure><p>ç®€è¦è¯´æ˜ï¼š</p><ul><li><code>TOPLEVEL</code> å¿…é¡»ä¸ Verilog ä¸­çš„æ¨¡å—åä¸€è‡´</li><li><code>MODULE=test_dff</code> æŒ‡å®š Python æµ‹è¯•å…¥å£</li><li><code>VERILOG_SOURCES</code> å†³å®šå‚ä¸ä»¿çœŸçš„ RTL æ–‡ä»¶</li><li><code>cocotb-config</code> è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„ä»¿çœŸå™¨åç«¯</li></ul><blockquote><p><strong>æ¢æ¨¡å—æ—¶ï¼Œåªéœ€æ”¹ï¼š</strong><br><code>src/*.sv</code>ã€<code>TOPLEVEL</code>ã€<code>MODULE</code>ï¼Œå…¶ä½™é€»è¾‘æ— éœ€ä¿®æ”¹ã€‚</p></blockquote><h2 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4. å°ç»“"></a>4. å°ç»“</h2><p>æœ¬ç¯‡ç¤ºä¾‹å±•ç¤ºäº† Cocotb æœ€å°å¯è¿è¡Œå·¥ç¨‹çš„ç»“æ„å’ŒåŸç†ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>Verilator + Cocotb çš„ååŒä»¿çœŸæµç¨‹</li><li>Verilog DUT çš„æ„æˆ</li><li>Python å¼‚æ­¥ testbench çš„å†™æ³•</li><li>Makefile å¦‚ä½•å°†ä¸¤è€…ä¸²è”</li></ul><p>åç»­ç¯‡ç« å°†ç»§ç»­æ›´æ–°ï¼š</p><ul><li>å¦‚ä½•åˆ©ç”¨ Python æŠŠä»¿çœŸç»“æœè½¬æ¢ä¸ºå¯è§†åŒ–å›¾è¡¨</li><li>å¦‚ä½•è®© Cocotb é€šè¿‡ ModelSim æ”¯æŒå¸¦ Vivado IP çš„ä»¿çœŸ</li></ul>]]></content>
    
    
    <summary type="html">åŸºäº Verilator ä¸ Cocotb å¯¹ Verilog æ¨¡å—è¿›è¡ŒååŒä»¿çœŸçš„åŸºç¡€æµç¨‹ä¸åŸç†è®²è§£</summary>
    
    
    
    
    <category term="cocotb" scheme="https://djdgctw.github.io/tags/cocotb/"/>
    
    <category term="verilog" scheme="https://djdgctw.github.io/tags/verilog/"/>
    
  </entry>
  
  <entry>
    <title>KV260 è§†é¢‘é“¾è·¯å®éªŒè®°å½•ï¼šä» ISP åˆ° HDMI</title>
    <link href="https://djdgctw.github.io/2025/02/20/video-pipeline-lab/"/>
    <id>https://djdgctw.github.io/2025/02/20/video-pipeline-lab/</id>
    <published>2025-02-20T01:30:00.000Z</published>
    <updated>2025-02-20T01:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬”è®°ä»¥â€œæ¨¡å—ç›®æ ‡ + å…³é”®å¯„å­˜å™¨ + éªŒè¯æ–¹æ³•â€è®°å½•ï¼Œæ–¹ä¾¿å¤ç°æˆ–ç§»æ¤åˆ°å…¶ä»–å¹³å°ã€‚</p></blockquote><h2 id="1-æ•´ä½“æ¶æ„"><a href="#1-æ•´ä½“æ¶æ„" class="headerlink" title="1. æ•´ä½“æ¶æ„"></a>1. æ•´ä½“æ¶æ„</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MIPI/RAW Sensor</span><br><span class="line">    â†“ (AXI Stream)</span><br><span class="line">Image Signal Processor (Demosaic + Gamma)</span><br><span class="line">    â†“</span><br><span class="line">AXI VDMA (Write)</span><br><span class="line">    â†“</span><br><span class="line">DDR åœ†å½¢ç¼“å†²</span><br><span class="line">    â†“</span><br><span class="line">AXI VDMA (Read)</span><br><span class="line">    â†“</span><br><span class="line">Video Mixer (OSD + Scaling)</span><br><span class="line">    â†“</span><br><span class="line">HDMI TX Subsystem</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ˜¯æŠŠ ISP ä¸ HDMI TX è§£è€¦ï¼Œé€šè¿‡ VDMA åšå¸§ç¼“å­˜ï¼Œè°ƒè¯•æ—¶å¯ä»¥å•ç‹¬éªŒè¯æ¯ä¸ª Stageã€‚</p><h2 id="2-Sensor-ISP"><a href="#2-Sensor-ISP" class="headerlink" title="2. Sensor &amp; ISP"></a>2. Sensor &amp; ISP</h2><ul><li>é€‰æ‹© <code>imx219</code> ä½œä¸º RAW è¾“å…¥ï¼ŒMIPI é…ç½®è„šæœ¬ä½¿ç”¨ <code>i2cset</code> å†™å¯„å­˜å™¨ï¼Œæ³¨æ„ <code>0x0157</code> éœ€è®¾ç½®ä¸ºæ­£ç¡®çš„ <code>line_length_pck</code>ã€‚</li><li>ISP åªå¼€å¯ Demosaic + Gammaï¼Œå…³é—­å˜ç„¦æ¨¡å—ä»¥å‡å°‘å»¶è¿Ÿã€‚</li><li>ç”¨ <code>v4l2-ctl --stream-mmap --stream-to=/dev/null --stream-count=200</code> å…ˆç¡®è®¤ Sensor è¾“å‡ºç¨³å®šã€‚</li></ul><h2 id="3-VDMA-çš„å…³é”®å¯„å­˜å™¨"><a href="#3-VDMA-çš„å…³é”®å¯„å­˜å™¨" class="headerlink" title="3. VDMA çš„å…³é”®å¯„å­˜å™¨"></a>3. VDMA çš„å…³é”®å¯„å­˜å™¨</h2><table><thead><tr><th>å¯„å­˜å™¨</th><th>ä½œç”¨</th><th>ç»éªŒå€¼</th></tr></thead><tbody><tr><td><code>MM2S_VSIZE</code></td><td>è¡Œæ•°</td><td>1080</td></tr><tr><td><code>MM2S_HSIZE</code></td><td>å•è¡Œå­—èŠ‚æ•°</td><td>3840 (1920Ã—2B)</td></tr><tr><td><code>FRMDLY_STRIDE</code></td><td>è¡Œé—´è·</td><td>4096, å¯¹é½ 4KB</td></tr></tbody></table><p>Tipsï¼šKV260 ä¸Š DDR é€šå¸¸é…ç½®ä¸º 32bit AXIï¼Œæ€»çº¿åˆ©ç”¨ç‡ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥æŠŠ <code>HSIZE</code> æ‰©å……åˆ° 4096 å­—èŠ‚æ¥åšçªå‘ã€‚</p><h2 id="4-è°ƒè¯•è„šæœ¬"><a href="#4-è°ƒè¯•è„šæœ¬" class="headerlink" title="4. è°ƒè¯•è„šæœ¬"></a>4. è°ƒè¯•è„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™é€š Sensor â†’ ISP â†’ VDMA</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe xlnx-isp</span><br><span class="line"><span class="built_in">sudo</span> modprobe xilinx-vdma</span><br><span class="line"></span><br><span class="line">media-ctl -d /dev/media0 -l <span class="string">&quot;&#x27;mipi_csi2 0&#x27;:1 -&gt; &#x27;xilinx-video 0&#x27;:0 [1]&quot;</span></span><br><span class="line">media-ctl -d /dev/media0 -V <span class="string">&quot;&#x27;mipi_csi2 0&#x27;:1 [fmt:SRGGB10_1X10/1920x1080@1/30]&quot;</span></span><br><span class="line"></span><br><span class="line">vdma_ctl write start --width 1920 --height 1080 --<span class="built_in">fmt</span> rgb</span><br></pre></td></tr></table></figure><h2 id="5-HDMI-è¾“å‡º"><a href="#5-HDMI-è¾“å‡º" class="headerlink" title="5. HDMI è¾“å‡º"></a>5. HDMI è¾“å‡º</h2><ul><li>HDMI TX Subsystem é€‰æ‹© 148.5â€¯MHz, Color Depth 8bitï¼Œå‹¾é€‰å†…ç½® InfoFrame ç”Ÿæˆå™¨ã€‚</li><li>å¦‚æœå±å¹•é»‘å±ï¼Œä¼˜å…ˆæ£€æŸ¥ <code>HPD</code> æ˜¯å¦æ‹‰é«˜ã€EDID è¯»å–æ˜¯å¦æˆåŠŸï¼ˆ<code>cat /sys/kernel/debug/dri/0/i915_edid_raw</code>ï¼‰ã€‚</li><li>ç”¨ <code>xilinx-axidma</code> å·¥å…·æ³¨å…¥å½©æ¡æ•°æ®ï¼Œå¯ä»¥éªŒè¯é“¾è·¯æ˜¯å¦æ­£ç¡®ã€‚</li></ul><h2 id="6-å¾…åŠ"><a href="#6-å¾…åŠ" class="headerlink" title="6. å¾…åŠ"></a>6. å¾…åŠ</h2><ul><li><input disabled="" type="checkbox"> å¢åŠ  HDR å…ƒæ•°æ®é€šè·¯</li><li><input disabled="" type="checkbox"> ç¼–å†™è‡ªåŠ¨åŒ– bring-up è„šæœ¬ï¼Œæ•´åˆåˆ° <code>make video-demo</code></li><li><input disabled="" type="checkbox"> æµ‹è¯•ä¸¤è·¯ PIP è¾“å‡º</li></ul><p>æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºä¸€èµ·è®¨è®ºã€‚</p>]]></content>
    
    
    <summary type="html">ç”¨ KV260 æ‰“é€š RAW Sensor â†’ ISP â†’ è§†é¢‘ç¼“å­˜ â†’ HDMI è¾“å‡ºçš„é“¾è·¯ï¼Œå¹¶è®°å½•è°ƒè¯•æ­¥éª¤ä¸å¯å¤ç”¨çš„è„šæœ¬ã€‚</summary>
    
    
    
    <category term="Lab Notes" scheme="https://djdgctw.github.io/categories/Lab-Notes/"/>
    
    
    <category term="HDMI" scheme="https://djdgctw.github.io/tags/HDMI/"/>
    
    <category term="KV260" scheme="https://djdgctw.github.io/tags/KV260/"/>
    
    <category term="è§†é¢‘é“¾è·¯" scheme="https://djdgctw.github.io/tags/%E8%A7%86%E9%A2%91%E9%93%BE%E8%B7%AF/"/>
    
    <category term="å®éªŒè®°å½•" scheme="https://djdgctw.github.io/tags/%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>HDMI 1.4 åè®®æ€»ç»“ï¼ˆä¸€ï¼‰ï¼šç»¼è¿°å’Œç¼–ç æ–¹å¼</title>
    <link href="https://djdgctw.github.io/2025/02/15/hello-world/"/>
    <id>https://djdgctw.github.io/2025/02/15/hello-world/</id>
    <published>2025-02-15T02:00:00.000Z</published>
    <updated>2025-02-15T02:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åšåè®®å­¦ä¹ ç¬”è®°æ—¶ï¼Œæˆ‘å–œæ¬¢æŒ‰ç…§â€œè¿­ä»£è„‰ç»œ â†’ ç‰©ç†å±‚ â†’ ç¼–ç  â†’ çŠ¶æ€æœºâ€çš„é¡ºåºå»æ‹†ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½èƒ½æŒ‚åœ¨è¿™ä¸ªä¸»çº¿ä¸‹ã€‚</p></blockquote><h2 id="1-ç‰ˆæœ¬æ¼”è¿›ä¸åº”ç”¨åœºæ™¯"><a href="#1-ç‰ˆæœ¬æ¼”è¿›ä¸åº”ç”¨åœºæ™¯" class="headerlink" title="1. ç‰ˆæœ¬æ¼”è¿›ä¸åº”ç”¨åœºæ™¯"></a>1. ç‰ˆæœ¬æ¼”è¿›ä¸åº”ç”¨åœºæ™¯</h2><ul><li><strong>HDMI 1.3 â†’ 1.4</strong>ï¼šæœ€å…³é”®çš„å˜åŒ–æ˜¯é€Ÿç‡ä» 2.25â€¯Gbps æå‡åˆ°äº† 3.4â€¯Gbpsï¼Œéšåå¸¦æ¥äº† 4K@30Hzã€3Dã€ä»¥å¤ªç½‘é€šé“ (HEC) ç­‰æ–°åŠŸèƒ½ã€‚</li><li><strong>æ¥å£å½¢å¼</strong>ï¼šType A&#x2F;Bï¼ˆç»å…¸ï¼‰ã€Type Cï¼ˆMiniï¼‰ã€Type Dï¼ˆMicroï¼‰ï¼ŒType E ä¸“ä¾›æ±½è½¦ç”µå­ã€‚ç¡¬ä»¶è®¾è®¡è¦å…³æ³¨ crosstalk ä¸ EMI é¢„ç®—ã€‚</li><li><strong>æ—¶é’Ÿå‚è€ƒ</strong>ï¼šTMDS Clock æœ€å¤§ 340â€¯MHzã€‚å¯¹ FPGA æ¥è¯´æ„å‘³ç€ PLL éœ€è¦æ”¯æŒ 742.5â€¯MHz ä»¥ä¸Šçš„é«˜é€Ÿä¸²å¹¶è½¬æ¢ï¼ˆ8&#x2F;10bitï¼‰ã€‚</li></ul><h2 id="2-TMDS-ä¿¡å·é“¾"><a href="#2-TMDS-ä¿¡å·é“¾" class="headerlink" title="2. TMDS ä¿¡å·é“¾"></a>2. TMDS ä¿¡å·é“¾</h2><p>HDMI çš„ä¸‰æ¡æ•°æ®é€šé“å’Œä¸€æ¡æ—¶é’Ÿé€šé“å…±äº«åŒä¸€ç»„å·®åˆ†å¯¹ã€‚æ•°æ®é“¾è·¯éµå¾ª TMDSï¼ˆTransition Minimized Differential Signalingï¼‰ç¼–ç ï¼š</p><ol><li><strong>é¢„å¤„ç†</strong>ï¼šåƒç´ æ•°æ®æŒ‰ R&#x2F;G&#x2F;B é€šé“é€å…¥ï¼Œæ§åˆ¶æœŸ (HBlank&#x2F;VBlank) ç”± <code>CTL[3:0]</code> ç½®ä½ã€‚</li><li><strong>8b&#x2F;10b</strong>ï¼šå…ˆåš XOR&#x2F;XNOR é™ä½ç¿»è½¬æ¬¡æ•°ï¼Œå†æ ¹æ® DC å¹³è¡¡é€‰æ‹© <code>q_m</code> çš„ææ€§ï¼Œæœ€åä¸²åŒ–æˆ 10bitã€‚</li><li><strong>åºåˆ—åŒ–</strong>ï¼šå¸¸è§åšæ³•æ˜¯ OSERDES Ã—2 çº§è”ï¼Œæ—¶é’Ÿå€é¢‘ 5 å€å DDR è¾“å‡ºã€‚</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šå·®åˆ†å¯¹é˜»æŠ— 100â€¯Î©ï¼Œå¸¸è§å¸ƒå±€è¦æ±‚ 5â€¯mil çº¿å®½ã€å¯¹å†…æ³¨å…¥ GND Guardã€‚æ¿çº§ EMI æ§åˆ¶åœ¨ 3â€¯Gbps ä»¥ä¸Šå°¤ä¸ºé‡è¦ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A(Pixel Bus) --&gt; B[TMDS Encoder]</span><br><span class="line">  B --&gt; C&#123;DC Balance&#125;</span><br><span class="line">  C --&gt;|10bit| D[Serializer]</span><br><span class="line">  D --&gt; E(TMDS Pair)</span><br></pre></td></tr></table></figure><h2 id="3-æ§åˆ¶æœŸç¼–ç "><a href="#3-æ§åˆ¶æœŸç¼–ç " class="headerlink" title="3. æ§åˆ¶æœŸç¼–ç "></a>3. æ§åˆ¶æœŸç¼–ç </h2><p>åœ¨æ¶ˆéšé˜¶æ®µï¼ŒTMDS æ•°æ®é€šé“ä¸å†ä¼ è¾“åƒç´ ï¼Œè€Œæ˜¯æºå¸¦å¸§åŒæ­¥ä¿¡æ¯ã€‚è¡¨æ ¼æ˜¯æˆ‘åœ¨é˜…è¯»æ ‡å‡†æ—¶æ•´ç†çš„é€ŸæŸ¥ç‰ˆæœ¬ï¼š</p><table><thead><tr><th>CTL[3:0]</th><th>æ„ä¹‰</th><th>é€šé“æ•°æ®</th></tr></thead><tbody><tr><td><code>0001</code></td><td>HSYNC æœ‰æ•ˆ</td><td>CH0 å‘é€ <code>1011001100</code></td></tr><tr><td><code>0010</code></td><td>VSYNC æœ‰æ•ˆ</td><td>CH1 å‘é€ <code>1011001100</code></td></tr><tr><td><code>0011</code></td><td>åŒæ—¶æœ‰æ•ˆ</td><td>CH2 å‘é€ <code>1011001100</code></td></tr><tr><td>å…¶ä»–</td><td>ä¿ç•™</td><td>å‘é€ <code>0100110011</code></td></tr></tbody></table><p>å¤šæ•°å­—åº“ä¼šæŠŠè¿™äº›æ¨¡å¼çƒ§åœ¨ ROM é‡Œï¼Œè‡ªå·±å®ç°æ—¶è®°å¾—è€ƒè™‘ pipeline çš„æ°”æ³¡ç®¡ç†ã€‚</p><h2 id="4-å·¥ç¨‹å®è·µ-Tips"><a href="#4-å·¥ç¨‹å®è·µ-Tips" class="headerlink" title="4. å·¥ç¨‹å®è·µ Tips"></a>4. å·¥ç¨‹å®è·µ Tips</h2><ol><li><strong>åƒç´ åŸŸä¸ TMDS åŸŸ</strong>ï¼šå¼ºçƒˆå»ºè®®ç”¨ <code>pixel_clk</code> åšåŒæ­¥é€»è¾‘ï¼Œå†é€šè¿‡ <code>BUFPLL/OSERDES</code> å°† TMDS åŸŸéš”ç¦»ï¼Œè·¨åŸŸåªä¼ æ§åˆ¶å­—ã€‚</li><li><strong>ILA è§‚æµ‹</strong>ï¼šæŠ“å– 10bit TMDS ç å­—èƒ½å¸®åŠ©å¿«é€Ÿå®šä½å‡ºé”™ Stageã€‚è‹¥ DC balance éœ‡è¡ï¼Œæ„å‘³ç€ XOR&#x2F;XNOR é€‰æ‹©é”™äº†ã€‚</li><li><strong>å‰å‘çº é”™</strong>ï¼šHDMI 1.4 ä»æ—§æ²¡æœ‰ FECï¼Œé“¾è·¯ç¨³å®šæ€§é«˜åº¦ä¾èµ–å¸ƒçº¿ä¸å™¨ä»¶ï¼Œé‡äº§è¦è€ƒè™‘çœ¼å›¾æµ‹è¯•ã€‚</li><li><strong>å¸¦å®½é¢„ç®—</strong>ï¼š4K@30Hz RGB444 éœ€è¦ 297â€¯MHz åƒç´ æ—¶é’Ÿï¼›8&#x2F;10bit ä¹‹åæ¯é€šé“ 2.97â€¯Gbpsï¼Œç•™è¶³ 20% è£•é‡ã€‚</li></ol><p>ä¸‹ä¸€ç¯‡ä¼šç»§ç»­å†™ <code>InfoFrame</code>ã€EDIDã€HDCP 1.4 æ¡æ‰‹ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµã€‚</p>]]></content>
    
    
    <summary type="html">æ¢³ç† HDMI 1.4 çš„ç‰ˆæœ¬è„‰ç»œã€é€Ÿç‡è§„æ ¼ä»¥åŠå…³é”®çš„ TMDS ç¼–ç æµç¨‹ï¼Œå¸®åŠ©å¿«é€Ÿå›å¿†é“¾è·¯è®¾è®¡è¦ç‚¹ã€‚</summary>
    
    
    
    <category term="æ¥å£åè®®" scheme="https://djdgctw.github.io/categories/%E6%8E%A5%E5%8F%A3%E5%8D%8F%E8%AE%AE/"/>
    
    
    <category term="HDMI" scheme="https://djdgctw.github.io/tags/HDMI/"/>
    
    <category term="TMDS" scheme="https://djdgctw.github.io/tags/TMDS/"/>
    
    <category term="è§†é¢‘æ¥å£" scheme="https://djdgctw.github.io/tags/%E8%A7%86%E9%A2%91%E6%8E%A5%E5%8F%A3/"/>
    
  </entry>
  
  <entry>
    <title>SpinalHDL Stream å°æŠ„ï¼š5 ä¸ªæå‡æµæ°´çº¿å¯è¯»æ€§çš„æŠ€å·§</title>
    <link href="https://djdgctw.github.io/2025/02/10/spinalhdl-stream-cheatsheet/"/>
    <id>https://djdgctw.github.io/2025/02/10/spinalhdl-stream-cheatsheet/</id>
    <published>2025-02-10T13:30:00.000Z</published>
    <updated>2025-02-18T00:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>SpinalHDL çš„ <code>Stream</code>&#x2F;<code>Flow</code> æ˜¯æ•°æ®è·¯å¾„çš„åŸºçŸ³ï¼Œè¯­æ³•ç®€å•ä½†å¾ˆå®¹æ˜“å†™æˆâ€œç¥ç§˜é»‘ç›’â€ã€‚è¿™ç¯‡æ•´ç†äº†å‡ ä¸ªæœ€å¸¸ç”¨çš„æŠ€å·§ã€‚</p><h2 id="1-çº¦å®šå¼å‘½å"><a href="#1-çº¦å®šå¼å‘½å" class="headerlink" title="1. çº¦å®šå¼å‘½å"></a>1. çº¦å®šå¼å‘½å</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pixIn  = slave <span class="type">Stream</span>(<span class="type">Pixel</span>())</span><br><span class="line"><span class="keyword">val</span> pixOut = master <span class="type">Stream</span>(<span class="type">Pixel</span>())</span><br></pre></td></tr></table></figure><p>æŠŠ <code>Stream</code> å½“ä½œâ€œä¸šåŠ¡æ•°æ® + æ¡æ‰‹â€çš„æ•´ä½“æ¥å‘½åï¼Œé¿å… <code>data</code>, <code>valid</code> åˆ†å®¶å¯¼è‡´é‡å¤è¿çº¿ã€‚</p><h2 id="2-ä¸"><a href="#2-ä¸" class="headerlink" title="2. &gt;&gt; ä¸ &lt;&lt; çš„ç”¨æ³•"></a>2. <code>&gt;&gt;</code> ä¸ <code>&lt;&lt;</code> çš„ç”¨æ³•</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pixOut &lt;&lt; pixIn.throwWhen(dropLine)</span><br></pre></td></tr></table></figure><p><code>&lt;&lt;</code> ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿æ¥ <code>valid/ready</code>. å½“éœ€è¦å¯¹ <code>payload</code> åšæ“ä½œæ—¶ï¼Œè®°å¾—ä½¿ç”¨ <code>.translateWith</code>ï¼Œå¦åˆ™ <code>valid</code> å’Œ <code>payload</code> çš„æ—¶åºä¼šé”™ä½ã€‚</p><h2 id="3-ç®¡çº¿åŒ–æ–¹æ³•"><a href="#3-ç®¡çº¿åŒ–æ–¹æ³•" class="headerlink" title="3. ç®¡çº¿åŒ–æ–¹æ³•"></a>3. ç®¡çº¿åŒ–æ–¹æ³•</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> stage2 = pixIn.m2sPipe()</span><br><span class="line"><span class="keyword">val</span> stage3 = stage2.queue(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><ul><li><code>m2sPipe</code>: åªå¯„å­˜ <code>payload</code></li><li><code>s2mPipe</code>: åªå¯„å­˜åå‹</li><li><code>queue</code>: å¸¦æ·±åº¦çš„ FIFOï¼Œå¯é€‰ <code>pipeline</code>, <code>flow</code>, <code>stream</code> æ¨¡å¼</li></ul><p>ç»„åˆä½¿ç”¨èƒ½å¤Ÿæ›´ä¸¥æ ¼åœ°æ§åˆ¶å»¶è¿Ÿã€‚</p><h2 id="4-è°ƒè¯•ï¼šç”¨-StreamMonitor"><a href="#4-è°ƒè¯•ï¼šç”¨-StreamMonitor" class="headerlink" title="4. è°ƒè¯•ï¼šç”¨ StreamMonitor"></a>4. è°ƒè¯•ï¼šç”¨ <code>StreamMonitor</code></h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StreamMonitor</span>(pixOut)&#123; packet =&gt;</span><br><span class="line">  assert(packet.payload.alpha &lt;= <span class="number">255</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­é… <code>SimTimeout</code>, <code>SimClockDomain</code> å¯ä»¥å¿«é€Ÿå®šä½ handshake cardingã€‚å°¤å…¶åœ¨è§†é¢‘é¡¹ç›®é‡Œï¼Œä¸€æ—¦ <code>ready</code> è¢«æ‹‰ä½ï¼Œæ•´å¸§éƒ½ä¼šâ€œè¤ªè‰²â€ï¼Œå¿…é¡»ç¬¬ä¸€æ—¶é—´å®šä½ã€‚</p><h2 id="5-ä¸-AXI4-Stream-çš„äº’æ“ä½œ"><a href="#5-ä¸-AXI4-Stream-çš„äº’æ“ä½œ" class="headerlink" title="5. ä¸ AXI4-Stream çš„äº’æ“ä½œ"></a>5. ä¸ AXI4-Stream çš„äº’æ“ä½œ</h2><p>SpinalHDL æä¾› <code>Axi4Stream</code> å°è£…ï¼Œå®é™…ä¸Šå°±æ˜¯ <code>Stream(Fragment(Bits()))</code>ã€‚å¸¸è§çš„æ¡¥æ¥å†™æ³•ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> axis = master <span class="type">Axi4Stream</span>(axiConfig)</span><br><span class="line"><span class="keyword">val</span> pix  = slave <span class="type">Stream</span>(<span class="type">Fragment</span>(<span class="type">Pixel</span>()))</span><br><span class="line"></span><br><span class="line">axis.payload.fragment := pix.payload.fragment.asBits</span><br><span class="line">axis.last              := pix.last</span><br><span class="line">pix.ready              := axis.ready</span><br></pre></td></tr></table></figure><h2 id="Checklist"><a href="#Checklist" class="headerlink" title="Checklist"></a>Checklist</h2><ul><li><input checked="" disabled="" type="checkbox"> ç»Ÿä¸€ä½¿ç”¨ <code>Stream</code> å‘½å</li><li><input checked="" disabled="" type="checkbox"> åŠ ä¸Š <code>queue</code>&#x2F;<code>pipe</code> æ³¨é‡Šå»¶è¿Ÿ</li><li><input disabled="" type="checkbox"> æ•´ç†ä¸€ä¸ªå¯å¤ç”¨çš„ <code>StreamBus</code> trait</li></ul><p>å¸Œæœ›è¿™ä»½å°æŠ„èƒ½å¸®ä½ å†™å‡ºæ›´ä¼˜é›…çš„æµæ°´çº¿æ¨¡å—ã€‚</p>]]></content>
    
    
    <summary type="html">è®°å½•åœ¨è§†é¢‘é“¾è·¯é¡¹ç›®é‡Œä½¿ç”¨ SpinalHDL Stream æ¥å£æ—¶ç§¯ç´¯çš„æ¨¡å¼ï¼Œä»å‘½ååˆ°ä»¿çœŸéƒ½è¦†ç›–ã€‚</summary>
    
    
    
    <category term="FPGA" scheme="https://djdgctw.github.io/categories/FPGA/"/>
    
    
    <category term="SpinalHDL" scheme="https://djdgctw.github.io/tags/SpinalHDL/"/>
    
    <category term="Scala" scheme="https://djdgctw.github.io/tags/Scala/"/>
    
    <category term="æµæ°´çº¿" scheme="https://djdgctw.github.io/tags/%E6%B5%81%E6%B0%B4%E7%BA%BF/"/>
    
    <category term="ç¬”è®°" scheme="https://djdgctw.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
